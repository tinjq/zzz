<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no">
    <title>Nav 导航</title>
    <link rel="stylesheet" href="assets/css/iconfont/iconfont.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/element-plus-index.css" />
    <link rel="stylesheet" href="assets/css/s3Layer.css">
    <link rel="stylesheet" href="assets/css/nav.css">
</head>

<body>
    <div id="app">
        <aside v-if="controlData.showMenu">
            <ul>
                <li v-for="(item, i) in items" :key="item.title">
                    <a :href="'#' + item.title + i" @click="expand($event)">
                        <i v-if="controlData.editModel" class="iconfont icon-delete" @click="deleteMenu($event,i)"></i>
                        <i v-if="controlData.editModel" class="iconfont icon-edit"
                            @click="editSite($event, false, true, true, i)"></i>
                        <i v-if="!controlData.editModel" class="iconfont icon-tag no-scale"></i>
                        <span class="title nowrap-ellipsis">{{item.title}}</span>
                        <i v-if="item.children && item.children.length > 0" class="iconfont icon-right no-scale"></i>
                    </a>
                    <ul v-if="item.children && item.children.length > 0">
                        <li v-for="(child, j) in item.children" :key="child.title">
                            <a :href="'#' + child.title + i + j">
                                <i v-if="controlData.editModel" class="iconfont icon-delete"
                                    @click="deleteMenu($event,i,j)"></i>
                                <i v-if="controlData.editModel" class="iconfont icon-edit"
                                    @click="editSite($event, false, false, true, i,j)"></i>
                                <span class="title nowrap-ellipsis">{{child.title}}</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </aside>

        <main>
            <header>
                <a @click="controlData.showMenu = !controlData.showMenu">
                    <i class="iconfont icon-category"></i>
                </a>
                </a>
                <a href="https://github.com/tinjq/zzz" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
            </header>

            <section>
                <div v-for="(item, i) in items" :key="item.title">
                    <h4 v-if="settings.showEmptyCategory || (item.sites && item.sites.length > 0)" :id="item.title + i">
                        {{item.title}}
                        <i v-if="controlData.editModel" class="iconfont icon-add"
                            @click="editSite($event, true, true, false, i)"></i>
                    </h4>
                    <div v-if="item.sites && item.sites.length > 0" class="site-cards">
                        <div v-for="(site, j) in item.sites" :key="site.child"
                            :style="settings.cardWidth ? `width:${settings.cardWidth}%` : ''">
                            <el-tooltip :content="tooltipContent(site)" raw-content>
                                <div class="site-card">
                                    <a :href="site.href" target="_blank">
                                        <p class="nowrap-ellipsis"><strong>{{site.title}}</strong></p>
                                        <p class="nowrap-ellipsis">{{site.remark}}</p>
                                    </a>
                                    <div v-if="controlData.editModel" class="edit-icons">
                                        <i class="iconfont icon-edit"
                                            @click="editSite($event, true, false, true, i, j)"></i>
                                        <i class="iconfont icon-delete" @click="editDelete(i, j)"></i>
                                    </div>
                                </div>
                            </el-tooltip>
                        </div>
                    </div>

                    <div v-if="item.children && item.children.length > 0" v-for="(child, j) in item.children"
                        :key="child.title">
                        <h4 v-if="settings.showEmptyCategory || (child.sites && child.sites.length > 0)"
                            :id="child.title + i + j">
                            {{child.title}}
                            <i v-if="controlData.editModel" class="iconfont icon-add"
                                @click="editSite($event, true, true, false, i, j)"></i>
                        </h4>
                        <div class="site-cards">
                            <div v-for="(site, k) in child.sites" :key="site.title"
                                :style="settings.cardWidth ? `width:${settings.cardWidth}%` : ''">
                                <el-tooltip :content="tooltipContent(site)" raw-content>
                                    <div class="site-card">
                                        <a :href="site.href" target="_blank">
                                            <p class="nowrap-ellipsis"><strong>{{site.title}}</strong></p>
                                            <p class="nowrap-ellipsis">{{site.remark}}</p>
                                        </a>
                                        <div v-if="controlData.editModel" class="edit-icons">
                                            <i class="iconfont icon-edit"
                                                @click="editSite($event, true, false, true, i, j, k)"></i>
                                            <i class="iconfont icon-delete" @click="editDelete(i, j, k)"></i>
                                        </div>
                                    </div>
                                </el-tooltip>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

            <footer class="footer-tools">
                <el-tooltip content="修改后要保存，否则刷新页面就丢了" placement="left">
                    <a v-show="controlData.editModel" class="rounded-circle" @click="saveData">
                        <i class="iconfont icon-save"></i>
                    </a>
                </el-tooltip>
                <el-tooltip content="切换修改模式" placement="left">
                    <a class="rounded-circle" @click="controlData.editModel = !controlData.editModel">
                        <i class="iconfont icon-edit"></i>
                    </a>
                </el-tooltip>
                <el-tooltip content="回到顶部" placement="left">
                    <a href="javascript:window.scrollTo({ top: 0 });" class="rounded-circle">
                        <i class="iconfont icon-to-up"></i>
                    </a>
                </el-tooltip>

                <el-tooltip content="设置" placement="left">
                    <a class="rounded-circle" @click="showSettingsForm">
                        <i class="iconfont icon-settings"></i>
                    </a>
                </el-tooltip>

                <el-dialog v-model="controlData.showSettings" title="设置">
                    <el-form label-width="auto">
                        <el-form-item label="显示空分类">
                            <el-switch v-model="controlData.showEmptyCategory" />
                        </el-form-item>
                        <el-form-item label="是否加密">
                            <el-switch v-model="controlData.crypto" />
                        </el-form-item>
                        <el-form-item v-if="controlData.crypto" label="加密密码">
                            <el-input v-model="controlData.password" type="password" autocomplete="off" />
                        </el-form-item>
                        <el-form-item label="卡片宽度(%)">
                            <el-input v-model="controlData.cardWidth" placeholder="33" />
                        </el-form-item>
                    </el-form>
                    <template #footer>
                        <div class="dialog-footer">
                            <el-button @click="controlData.showSettings = false">取消</el-button>
                            <el-button type="primary" @click="confirmSettings">确定</el-button>
                        </div>
                    </template>
                </el-dialog>
            </footer>

            <div class="marsk" onclick="this.style.display = 'none'">
                <div class="popup" onclick="event.stopPropagation()">
                    <div>标题：<input type="text" v-model="editData.title"></div>
                    <div v-if="editFlag.info">链接：<input type="text" v-model="editData.href"></div>
                    <div v-if="editFlag.info">图片：<input type="text" v-model="editData.icon"></div>
                    <div v-if="editFlag.info">备注：<input type="text" v-model="editData.remark"></div>
                    <div v-if="editFlag.info">描述：<input type="text" v-model="editData.description"></div>
                    <div class="btns">
                        <button v-if="editFlag.btns" @click="editUpdate">修改</button>
                        <button v-if="editFlag.btns" @click="insertBefore">前面插入</button>
                        <button v-if="editFlag.btns" @click="insertAfter">后面插入</button>
                        <button v-if="editFlag.child" @click="appendChild">添加子项</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="assets/js/vue.global.prod.js"></script>
    <script src="assets/js/s3Layer.umd.min.js"></script>
    <script src="assets/js/crypto-js.min.js"></script>
    <script src="assets/js/zzz.js"></script>
    <script src="assets/js/element-plus.min.js"></script>
    <script src="assets/js/zzz-nav.js" id="zzz-nav"></script>
</body>

</html>